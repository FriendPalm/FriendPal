<template name="Messenger">
  {{#IfLoggedIn}}
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
        rel="stylesheet">
  <div class="row">

    <div class="col s1 m1 l1">
      <a href="{{ pathFor 'Learn' }}" class="learn">
        <div class=" side-bar blue card">
          <div style="height: 500px;"><i class="material-icons">g_translate</i></div>
        </div>
      </a>
    </div>

    <div class="col s11 m11 l11">
      <div class="row">
        <div class="card">Unread Messages</div>
        {{#each newMessages}}
        <div
          class="col s2 m2 l2">
          <pre><a href="{{ pathFor 'ReadMessage' }}" class="letter">{{sender}}: {{subject}}</a></pre>
        </div>
        {{/each}}
      </div>
      <div class="row">
        <!-- code courtesy of Austin Keeley https://github.com/austinkeeley -->
        <div class="card">
          <div class="col s6 m6 l6">
            <h5>personal</h5>
            <div style=" overflow-y: scroll; height: 250px">
              {{#each messageList}}<pre>{{sender}}({{subject}}):@{{receiver}} {{text}}
    </pre>
              {{/each}}
            </div>
          </div>
          <div class="col s6 m6 l6">
            <h5>general</h5>
            <div style=" overflow-y: scroll; height: 250px">
              {{#each generalMessages}}
              <pre>{{sender}}: {{text}}</pre>
              {{/each}}
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <ul class="collapsible popout" data-collapsible="accordion">
          <li>
            <div class="collapsible-header">Compose Message</div>
            <div class="collapsible-body">
<pre>
              <div class="col s6 m6 l6">To: <input id="to" type="text" value=""/></div>
              <div class="col s6 m6 l6">Subject:<input id="subject" type="text" value=""/></div>
              <div class="col s12 m12 l12"> Message:<input id="chatInput"/><input type="submit" value="Send"
                                                                                  class="btn"/>
              </div></pre>

            </div>
          </li>
        </ul>

      </div>
      <div class="row">
        <div class="card">
          Letters
        </div>
      </div>
      <div class="row">
        <div class="col s6">
          {{#each allLetters}}
          <pre>{{sender}}: {{text}} <a href="#" class="remove">delete</a></pre>
          {{/each}}
        </div>
        <div class="col s6">bar</div>

      </div>
    </div>
  </div>
  {{/IfLoggedIn}}
  <script>

    $(document).ready(function () {
      /* function stolen from W3Schools http://www.w3schools.com/js/js_cookies.asp
       * finds a particular value of the given key in the cookies list
       * param: cname key name
       * return: value of the given key
       */
      function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') c = c.substring(1);
          if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
        }
        return "";
      }

      //init cellapsible
      $(document).ready(function(){
        $('.collapsible').collapsible({
          accordion : false // A setting that changes the collapsible behavior to expandable instead of the default accordion style
        });
      });

      //load messenger field values
      document.getElementById("to").value = getCookie("toField");
      document.getElementById("subject").value = getCookie("subjectField");
      document.getElementById("chatInput").value = getCookie("chatField");
    });
  </script>
</template>